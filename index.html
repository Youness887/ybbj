<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexus V8 - القائد الرقمي</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@300;400;600;700&display=swap');
        body { font-family: 'IBM+Plex+Sans+Arabic', sans-serif; background-color: #020617; color: #e2e8f0; }
        .glass { background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(12px); border: 1px border rgba(255,255,255,0.05); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden">

    <!-- Header -->
    <header class="p-4 border-b border-white/5 glass flex justify-between items-center z-50">
        <div class="flex items-center gap-3">
            <div class="w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center shadow-lg shadow-indigo-500/20">
                <i data-lucide="cpu" class="text-white w-5 h-5"></i>
            </div>
            <h1 class="text-xs font-black tracking-tighter text-white uppercase italic">Nexus V8.1 Stable</h1>
        </div>
        <div class="flex gap-2">
            <button onclick="switchTab('chat')" id="btn-chat" class="px-5 py-1.5 rounded-full text-[10px] font-bold bg-indigo-600 text-white transition-all">القيادة</button>
            <button onclick="switchTab('gallery')" id="btn-gallery" class="px-5 py-1.5 rounded-full text-[10px] font-bold bg-slate-800 text-slate-400 transition-all">المعرض</button>
            <button onclick="toggleSettings()" class="p-2 bg-slate-800 rounded-lg hover:bg-slate-700 transition-all">
                <i data-lucide="settings" class="w-4 h-4 text-slate-400"></i>
            </button>
        </div>
    </header>

    <!-- Settings Modal -->
    <div id="settings-modal" class="hidden fixed inset-0 bg-black/90 z-[100] flex items-center justify-center p-6">
        <div class="bg-slate-900 border border-white/10 w-full max-w-sm rounded-3xl p-8 shadow-2xl animate-in zoom-in-95">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-sm font-black text-white uppercase italic flex items-center gap-2">
                    <i data-lucide="shield" class="w-4 h-4 text-indigo-500"></i> إعدادات الربط
                </h2>
                <button onclick="toggleSettings()"><i data-lucide="x" class="w-5 h-5"></i></button>
            </div>
            <div class="space-y-4">
                <p class="text-[10px] text-slate-500 leading-relaxed">أدخل مفتاح Gemini API الخاص بك لتفعيل التوليد بالذكاء الاصطناعي.</p>
                <input type="password" id="api-key-input" placeholder="Paste your API key here..." 
                       class="w-full bg-black border border-white/10 rounded-xl py-3 px-4 text-xs outline-none focus:border-indigo-500 text-white">
                <button onclick="saveApiKey()" class="w-full bg-indigo-600 py-3 rounded-xl text-xs font-black text-white hover:bg-indigo-500 transition-all shadow-lg shadow-indigo-600/20">حفظ الإعدادات</button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main id="chat-tab" class="flex-1 overflow-y-auto p-4 md:p-10 space-y-6 pb-32 no-scrollbar">
        <div class="text-center py-20 opacity-20" id="welcome-msg">
            <i data-lucide="sparkles" class="w-12 h-12 mx-auto mb-4 text-indigo-500"></i>
            <h3 class="text-lg font-black italic">نظام Nexus جاهز للعمل</h3>
            <p class="text-[10px] mt-2">قم بربط الـ API وابدأ بصناعة أصولك الرقمية</p>
        </div>
        <div id="chat-messages" class="space-y-6"></div>
    </main>

    <main id="gallery-tab" class="hidden flex-1 overflow-y-auto p-6 md:p-10 animate-in fade-in duration-500">
        <h2 class="text-2xl font-black italic mb-8">المعرض الرقمي</h2>
        <div id="gallery-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6"></div>
    </main>

    <!-- Footer Input -->
    <footer class="p-4 glass border-t border-white/5">
        <div class="max-w-3xl mx-auto relative flex items-center">
            <input type="text" id="user-input" placeholder="اطلب تصميم 'عملة ذهبية باسم يونس'..." 
                   class="w-full bg-slate-900 border border-white/10 rounded-2xl py-4 px-6 pr-14 text-xs outline-none focus:border-indigo-500 text-white transition-all shadow-2xl">
            <button onclick="handleSend()" class="absolute left-2 p-3 bg-indigo-600 rounded-xl text-white hover:bg-indigo-500 shadow-xl transition-all">
                <i data-lucide="send" class="w-5 h-5"></i>
            </button>
        </div>
    </footer>

    <script>
        // Initialize Lucide Icons
        lucide.createIcons();

        let apiKey = localStorage.getItem('nexus_api_key') || '';
        let inventory = JSON.parse(localStorage.getItem('nexus_inventory')) || [];

        function toggleSettings() {
            const modal = document.getElementById('settings-modal');
            modal.classList.toggle('hidden');
            document.getElementById('api-key-input').value = apiKey;
        }

        function saveApiKey() {
            apiKey = document.getElementById('api-key-input').value;
            localStorage.setItem('nexus_api_key', apiKey);
            toggleSettings();
        }

        function switchTab(tab) {
            const chatTab = document.getElementById('chat-tab');
            const galleryTab = document.getElementById('gallery-tab');
            const btnChat = document.getElementById('btn-chat');
            const btnGallery = document.getElementById('btn-gallery');

            if (tab === 'chat') {
                chatTab.classList.remove('hidden');
                galleryTab.classList.add('hidden');
                btnChat.className = "px-5 py-1.5 rounded-full text-[10px] font-bold bg-indigo-600 text-white transition-all";
                btnGallery.className = "px-5 py-1.5 rounded-full text-[10px] font-bold bg-slate-800 text-slate-400 transition-all";
            } else {
                chatTab.classList.add('hidden');
                galleryTab.classList.remove('hidden');
                btnGallery.className = "px-5 py-1.5 rounded-full text-[10px] font-bold bg-indigo-600 text-white transition-all";
                btnChat.className = "px-5 py-1.5 rounded-full text-[10px] font-bold bg-slate-800 text-slate-400 transition-all";
                renderGallery();
            }
        }

        async function handleSend() {
            const inputEl = document.getElementById('user-input');
            const text = inputEl.value.trim();
            if (!text) return;
            if (!apiKey) { toggleSettings(); return; }

            addMessage('user', text);
            inputEl.value = '';
            document.getElementById('welcome-msg').classList.add('hidden');

            const loadingId = addMessage('assistant', 'جاري التفكير والتوليد...');

            try {
                // Gemini Text Request
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: text }] }] })
                });
                const data = await response.json();
                const aiText = data.candidates[0].content.parts[0].text;

                let imageHtml = '';
                // Simple Image Logic
                if (text.includes('يونس') || text.includes('صورة') || text.includes('NFT')) {
                    const imgRes = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/imagen-4.0-generate-001:predict?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            instances: { prompt: `Golden 3D NFT coin, name 'Younes' engraved, cinematic lighting, luxury` },
                            parameters: { sampleCount: 1 }
                        })
                    });
                    const imgData = await imgRes.imgRes.json();
                    const b64 = imgData.predictions[0].bytesBase64Encoded;
                    const imageUrl = `data:image/png;base64,${b64}`;
                    
                    imageHtml = `<img src="${imageUrl}" class="mt-4 rounded-2xl w-full border border-white/10 shadow-2xl">`;
                    
                    // Save to Inventory
                    inventory.unshift({ id: Date.now(), image: imageUrl, name: text.substring(0, 20) });
                    localStorage.setItem('nexus_inventory', JSON.stringify(inventory));
                }

                updateMessage(loadingId, aiText + imageHtml);
            } catch (err) {
                updateMessage(loadingId, "خطأ: تأكد من صحة مفتاح API ومن اتصالك بالإنترنت.");
            }
        }

        function addMessage(role, content) {
            const id = Date.now();
            const container = document.getElementById('chat-messages');
            const div = document.createElement('div');
            div.className = `flex ${role === 'user' ? 'justify-end' : 'justify-start'} animate-in slide-in-from-bottom-2 duration-300`;
            div.innerHTML = `
                <div id="msg-${id}" class="max-w-[85%] p-4 rounded-2xl text-xs leading-relaxed shadow-xl ${role === 'user' ? 'bg-indigo-600 text-white rounded-tr-none' : 'bg-slate-900 border border-white/5 rounded-tl-none'}">
                    ${content}
                </div>
            `;
            container.appendChild(div);
            div.scrollIntoView({ behavior: 'smooth' });
            return id;
        }

        function updateMessage(id, content) {
            const el = document.getElementById(`msg-${id}`);
            if (el) el.innerHTML = content;
        }

        function renderGallery() {
            const grid = document.getElementById('gallery-grid');
            grid.innerHTML = inventory.map(item => `
                <div class="bg-slate-900 rounded-[2rem] border border-white/5 overflow-hidden hover:border-indigo-500/50 transition-all shadow-xl group">
                    <img src="${item.image}" class="w-full aspect-square object-cover group-hover:scale-105 transition-transform duration-500">
                    <div class="p-4">
                        <p class="text-[10px] font-black text-white uppercase truncate">${item.name}</p>
                        <p class="text-[8px] text-slate-500 mt-1 uppercase tracking-widest">Digital Asset</p>
                    </div>
                </div>
            `).join('');
            if (inventory.length === 0) {
                grid.innerHTML = `<div class="col-span-full py-20 text-center opacity-20 uppercase font-black text-xs italic tracking-widest">المعرض فارغ حالياً</div>`;
            }
        }
    </script>
</body>
</html>

