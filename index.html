<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Nexus V8 - Lazy Minting</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <style>
        body { font-family: 'Tajawal', sans-serif; background-color: #020617; color: #e2e8f0; }
        .nexus-gradient { background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%); }
        .glass-card { background: rgba(30, 41, 59, 0.4); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.05); }
    </style>
</head>
<body class="bg-slate-950">
    <div id="root"></div>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        const { useState } = React;

        function App() {
            const [account, setAccount] = useState(null);
            const [isSigning, setIsSigning] = useState(false);
            const [voucher, setVoucher] = useState(null);

            const connectWallet = async () => {
                if (!window.ethereum) return alert("افتح MetaMask!");
                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                setAccount(accounts[0]);
            };

            // وظيفة الـ Lazy Mint (توقيع بدون دفع غاز)
            const createLazyNFT = async () => {
                if (!account) return alert("اربط المحفظة أولاً");
                setIsSigning(true);

                try {
                    const provider = new ethers.providers.Web3Provider(window.ethereum);
                    const signer = provider.getSigner();
                    
                    const minPrice = ethers.utils.parseEther("0.01"); // سعر البيع المستقبلي
                    const uri = "ipfs://your-metadata-hash"; // رابط الصورة
                    
                    const domain = {
                        name: "Nexus-LazyMint",
                        version: "1",
                        chainId: 137, // Polygon
                        verifyingContract: "0xYourContractAddress" // سيتم وضع عنوان العقد بعد النشر
                    };

                    const types = {
                        NFTVoucher: [
                            { name: "minPrice", type: "uint256" },
                            { name: "uri", type: "string" }
                        ]
                    };

                    const value = { minPrice, uri };

                    // التوقيع الرقمي (مجاني تماماً للمبدع)
                    const signature = await signer._signTypedData(domain, types, value);
                    
                    setVoucher({ ...value, signature });
                    alert("تم إنشاء الـ NFT وتوقيعه بنجاح! يمكن للمشترين صكه الآن.");
                } catch (err) {
                    console.error(err);
                    alert("فشل التوقيع.");
                } finally {
                    setIsSigning(false);
                }
            };

            return (
                <div className="flex flex-col min-h-screen max-w-md mx-auto bg-[#020617] p-6 space-y-8">
                    <header className="flex justify-between items-center py-4">
                        <h1 className="text-xl font-black nexus-gradient bg-clip-text text-transparent italic">NEXUS V8</h1>
                        <button onClick={connectWallet} className="text-[10px] font-bold px-4 py-2 rounded-full border border-slate-700">
                            {account ? `${account.substring(0,6)}...` : 'Connect'}
                        </button>
                    </header>

                    <div className="glass-card rounded-[2.5rem] p-8 text-center space-y-6">
                        <div className="w-24 h-24 mx-auto nexus-gradient rounded-full flex items-center justify-center shadow-2xl shadow-indigo-500/20">
                            <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="white" strokeWidth="2"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg>
                        </div>
                        <h2 className="text-2xl font-black text-white leading-tight">صناعة الـ NFT بدون دفع غاز</h2>
                        <p className="text-slate-400 text-sm leading-relaxed">باستخدام تقنية Lazy Minting، يمكنك عرض أعمالك للبيع فوراً، ورسوم التسجيل في البلوكشين يدفعها المشتري لاحقاً.</p>
                        
                        <button 
                            onClick={createLazyNFT}
                            disabled={isSigning}
                            className="w-full py-5 rounded-2xl nexus-gradient text-white font-black shadow-lg active:scale-95 transition-all disabled:opacity-50"
                        >
                            {isSigning ? 'جاري التوقيع...' : 'إنشاء وتوقيع NFT جديد'}
                        </button>
                    </div>

                    {voucher && (
                        <div className="p-4 bg-emerald-500/10 border border-emerald-500/20 rounded-2xl animate-in fade-in">
                            <p className="text-emerald-400 text-[10px] font-bold uppercase mb-2">✅ تم توليد قسيمة الصك (Voucher)</p>
                            <div className="text-[8px] font-mono text-slate-500 break-all bg-black/40 p-2 rounded">
                                {voucher.signature}
                            </div>
                        </div>
                    )}

                    <div className="text-center pt-10">
                        <p className="text-[10px] text-slate-600 font-bold uppercase tracking-[0.2em]">Zero Gas Fee Infrastructure</p>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

