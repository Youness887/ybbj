<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Nexus Web3 Debug</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
    <!-- استخدام نسخة مستقرة من Ethers.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <style>
        body { font-family: 'Tajawal', sans-serif; background-color: #020617; color: #e2e8f0; }
        .nft-btn { background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%); }
        .error-msg { background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.2); color: #f87171; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function App() {
            const [account, setAccount] = useState(null);
            const [error, setError] = useState('');
            const [loading, setLoading] = useState(false);

            const connectWallet = async () => {
                setError('');
                setLoading(true);
                
                try {
                    // 1. التحقق من وجود محفظة
                    if (typeof window.ethereum === 'undefined') {
                        throw new Error('لم يتم العثور على محفظة. يرجى فتح الموقع من داخل تطبيق MetaMask.');
                    }

                    // 2. طلب الحسابات
                    const accounts = await window.ethereum.request({ 
                        method: 'eth_requestAccounts' 
                    });
                    
                    if (accounts.length > 0) {
                        setAccount(accounts[0]);
                    } else {
                        throw new Error('لم يتم اختيار أي حساب.');
                    }
                } catch (err) {
                    console.error(err);
                    setError(err.message || 'حدث خطأ غير متوقع أثناء الاتصال.');
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="flex flex-col h-screen max-w-xl mx-auto border-x border-slate-800 bg-[#020617] relative">
                    {/* Top Header */}
                    <header className="p-5 border-b border-slate-800 flex justify-between items-center bg-slate-900/50">
                        <div className="flex items-center gap-2">
                            <div className="w-8 h-8 nft-btn rounded-lg flex items-center justify-center shadow-lg">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="white" strokeWidth="2.5"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
                            </div>
                            <span className="text-white font-black text-xs tracking-tighter">NEXUS V8</span>
                        </div>
                        
                        <button 
                            onClick={connectWallet}
                            disabled={loading}
                            className={`px-4 py-2 rounded-xl text-[10px] font-black uppercase transition-all border ${
                                account ? 'border-emerald-500 text-emerald-400' : 'border-indigo-500 text-white nft-btn'
                            }`}
                        >
                            {loading ? 'جاري الاتصال...' : account ? `متصل: ${account.substring(0,6)}...` : 'Connect Wallet'}
                        </button>
                    </header>

                    {/* Main Interface */}
                    <main className="flex-1 p-6 flex flex-col justify-center text-center">
                        {error && (
                            <div className="error-msg p-4 rounded-2xl text-xs mb-6 animate-pulse">
                                ⚠️ {error}
                            </div>
                        )}

                        <div className="mb-8 relative">
                            <div className="w-32 h-32 mx-auto bg-indigo-500/5 rounded-full flex items-center justify-center border border-indigo-500/10">
                                <svg width="50" height="50" viewBox="0 0 24 24" fill="none" stroke="#6366f1" strokeWidth="1"><path d="M21 12V7a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h7"></path><path d="M16 19h6"></path><path d="M19 16v6"></path></svg>
                            </div>
                        </div>

                        <h2 className="text-2xl font-black text-white mb-2">
                            {account ? 'تم الربط بنجاح' : 'مركز العمليات الرقمية'}
                        </h2>
                        <p className="text-slate-500 text-sm mb-10 leading-relaxed">
                            {account 
                                ? 'المحفظة جاهزة الآن لإرسال المعاملات وصك الرموز.' 
                                : 'يرجى ربط محفظتك الرقمية لتتمكن من الوصول إلى ميزات الـ NFT والتداول.'}
                        </p>

                        {account ? (
                            <div className="space-y-3">
                                <button className="w-full py-4 rounded-2xl nft-btn text-white font-black shadow-xl">
                                    ابدأ عملية الصك (Mint)
                                </button>
                                <p className="text-[10px] text-slate-600 font-bold uppercase tracking-widest">المحفظة متصلة بشبكة Ethereum</p>
                            </div>
                        ) : (
                            <button onClick={connectWallet} className="w-full py-4 rounded-2xl bg-slate-800 text-slate-300 font-black border border-slate-700 hover:bg-slate-700 transition-all">
                                اضغط هنا للربط
                            </button>
                        )}
                    </main>

                    <footer className="p-4 text-center border-t border-slate-900">
                        <span className="text-[9px] text-slate-700 font-black tracking-[0.4em] uppercase">Web3 Engine Active</span>
                    </footer>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

